&ACCESS RV
&REL 11735
&PARAM DISKPATH = KRC:\R1\Program\ROS
DEFDAT command_handler PUBLIC
    GLOBAL ENUM DriverState INITIALIZED, INACTIVE, ACTIVE
    GLOBAL ENUM EventType NONE, INVALID, STARTED, STOPPED, CANCELLED, RESET_OK, ERROR, CONNECTED, SWITCH_OK, DRIVES_TURNED_ON, DRIVES_TURNED_OFF
    GLOBAL ENUM CMDType CMD_NONE, CMD_CON, CMD_START, CMD_RESET, CMD_CANCEL, CMD_CHANGE, CMD_INVALID, CMD_DRIVES_ON, CMD_DRIVES_OFF
    GLOBAL ENUM ControlMode INACTIVE, JOINT_POSITION, CART_POSITION

    GLOBAL STRUC Command CHAR cmd_str[32], INT control_mode
    STRUC StringCommandPair CHAR cmd_string[32], CMDType cmd_type

    DECL DriverState current_driver_state = #INITIALIZED

    ; Constants for easier mapping of strings to command types
    CONST INT CMD_COUNT = 8
    DECL CONST StringCommandPair STRING_COMMAND_PAIRS[8]
    STRING_COMMAND_PAIRS[1] = { cmd_string[] "CON", cmd_type #CMD_CON }
    STRING_COMMAND_PAIRS[2] = { cmd_string[] "START", cmd_type #CMD_START }
    STRING_COMMAND_PAIRS[3] = { cmd_string[] "RESET", cmd_type #CMD_RESET }
    STRING_COMMAND_PAIRS[4] = { cmd_string[] "CANCEL", cmd_type #CMD_CANCEL }
    STRING_COMMAND_PAIRS[5] = { cmd_string[] "CHANGE", cmd_type #CMD_CHANGE }
    STRING_COMMAND_PAIRS[6] = { cmd_string[] "NONE", cmd_type #CMD_NONE }
    STRING_COMMAND_PAIRS[7] = { cmd_string[] "DRIVES_ON", cmd_type #CMD_DRIVES_ON }
    STRING_COMMAND_PAIRS[8] = { cmd_string[] "DRIVES_OFF", cmd_type #CMD_DRIVES_OFF }
ENDDAT
